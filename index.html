<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IMDb Top 50 Narrative Visualization</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
  <div id="container">
    <div id="nav">
      <button id="prev">Previous</button>
      <button id="next">Next</button>
    </div>
    <div id="content"></div>
  </div>

  <script>
    const scenes = [
      {
        title: "Overview of IMDb Top 50",
        description: "This scene provides an overview of the IMDb Top 50 movies.",
        render: renderOverview
      },
      {
        title: "Top 10 Movies by Rating",
        description: "This scene highlights the top 10 movies by their IMDb rating.",
        render: renderTop10
      },
      {
        title: "Distribution of Ratings",
        description: "This scene shows the distribution of ratings among the top 50 movies.",
        render: renderRatingDistribution
      }
    ];

    let currentSceneIndex = 0;

    function updateScene(index) {
      const scene = scenes[index];
      d3.select("#content").html("");
      d3.select("#content").append("h2").text(scene.title);
      d3.select("#content").append("p").text(scene.description);
      scene.render();
    }

    async function renderOverview() {
        const svg = d3.select("#content").append("svg").attr("width", 800).attr("height", 400);
        const data = await d3.dsv("\t", "IMDbTopRated.csv");
        console.log(data);

        const circles = svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx", (d, i) => (i % 10) * 80 + 40)
        .attr("cy", (d, i) => Math.floor(i / 10) * 80 + 40)
        .attr("r", 30)
        .attr("fill", "steelblue");

      circles.append("title")
        .text(d => d.Title);

      svg.selectAll("text")
        .data(data)
        .enter()
        .append("text")
        .attr("x", (d, i) => (i % 10) * 80 + 40)
        .attr("y", (d, i) => Math.floor(i / 10) * 80 + 40 + 40) // Adjust the y position to be below the circles
        .attr("text-anchor", "middle")
        .text(d => d.Title)
        .attr("font-size", "10px")
        .attr("fill", "black");
    }

    function renderTop10() {
        const svg = d3.select("#content").append("svg").attr("width", 800).attr("height", 400);
        const data = await d3.dsv("\t", "IMDbTopRated.csv");
        
        // const top10 = data.sort((a, b) => b.Rating - a.Rating).slice(0, 10);
        // console.log(data);


        // svg.selectAll("rect")
        //   .data(top10)
        //   .enter()
        //   .append("rect")
        //   .attr("x", (d, i) => i * 80 + 40)
        //   .attr("y", d => 400 - d['Rating'] * 40)
        //   .attr("width", 40)
        //   .attr("height", d => d['Rating'] * 40)
        //   .attr("fill", "orange")
        //   .append("title")
        //   .text(d => `${d.Title}\nRating: ${d.Rating}`);

          // Parse ratings as numbers
        data.forEach(d => {
            d.Rating = +d.Rating;
        });

        // Sort the data by rating and get the top 10
        const top10 = data.sort((a, b) => b.Rating - a.Rating).slice(0, 10);

        // Log top 10 data to console
        console.log(top10);

        // Set up scales
        const xScale = d3.scaleBand()
            .domain(top10.map(d => d.Title))
            .range([0, 800])
            .padding(0.1);

        const yScale = d3.scaleLinear()
            .domain([0, 10])
            .range([400, 0]);

        // Add bars to the chart
        svg.selectAll("rect")
            .data(top10)
            .enter()
            .append("rect")
            .attr("x", (d, i) => xScale(d.Title))
            .attr("y", d => yScale(d.Rating))
            .attr("width", xScale.bandwidth())
            .attr("height", d => 400 - yScale(d.Rating))
            .attr("fill", "orange")
            .append("title")
            .text(d => `${d.Title}\nRating: ${d.Rating}`);

        // Add x-axis
        svg.append("g")
            .attr("transform", "translate(0, 400)")
            .call(d3.axisBottom(xScale))
            .selectAll("text")
            .attr("transform", "rotate(-45)")
            .style("text-anchor", "end");

        // Add y-axis
        svg.append("g")
            .call(d3.axisLeft(yScale));
        
    }

    function renderRatingDistribution() {
        d3.csv('https://raw.githubusercontent.com/minals586/minals586.github.io/main/IMDbTopRated.csv').then(data => {
        const svg = d3.select("#content").append("svg").attr("width", 800).attr("height", 400);

        const xScale = d3.scaleLinear()
          .domain([0, 10])
          .range([50, 750]);

        const histogram = d3.histogram()
          .domain(xScale.domain())
          .thresholds(xScale.ticks(10))
          .value(d => d.Rating);

        const bins = histogram(data);

        const yScale = d3.scaleLinear()
          .domain([0, d3.max(bins, d => d.length)])
          .range([400, 50]);

        svg.selectAll("rect")
          .data(bins)
          .enter()
          .append("rect")
          .attr("x", d => xScale(d.x0))
          .attr("y", d => yScale(d.length))
          .attr("width", d => xScale(d.x1) - xScale(d.x0) - 1)
          .attr("height", d => 400 - yScale(d.length))
          .attr("fill", "green");

        svg.append("g")
          .attr("transform", "translate(0,400)")
          .call(d3.axisBottom(xScale));

        svg.append("g")
          .attr("transform", "translate(50,0)")
          .call(d3.axisLeft(yScale));
      });
    }

    document.getElementById("prev").addEventListener("click", () => {
      if (currentSceneIndex > 0) {
        currentSceneIndex--;
        updateScene(currentSceneIndex);
      }
    });

    document.getElementById("next").addEventListener("click", () => {
      if (currentSceneIndex < scenes.length - 1) {
        currentSceneIndex++;
        updateScene(currentSceneIndex);
      }
    });

    updateScene(currentSceneIndex);
  </script>
</body>
</html>